import{r,u as P,l as A,o as F,d as c,e as a,z as d,A as h,B as T,F as D,h as U,i as V,f as E,C as q,D as z,c as n,t as N}from"./index-CMPOgCmU.js";import{c as g,w as b,S as u,d as B}from"./api-F9C-BKG7.js";import{E as j}from"./Editor-sdaFGOaK.js";import"./axios-Bo0ATomq.js";const L={class:"container mt-4"},M=a("h2",null,"Edit Article",-1),R={class:"mb-3"},$=a("label",{for:"title",class:"form-label"},"標題",-1),O={class:"mb-3"},G=a("label",{for:"category",class:"form-label"},"文章分類",-1),H=["value"],J={class:"mb-3"},K=a("label",{for:"image",class:"form-label"},"封面圖片",-1),Q=["src"],W={class:"mb-3"},X=a("label",{for:"summaryContent",class:"form-label"},"概要內容",-1),Y={class:"mb-3"},Z=a("label",{for:"content",class:"form-label"},"文章內容",-1),f="/v1/articles",ee="/v1/articleclasses",oe={__name:"ArticlesEditView",setup(te){const p=r(null),i=P(),_=A(),C="https://xiaoqingblog-xiaoqingblog.azuremicroservices.io/xiaoqingblog/images",e=r({articleId:"",articleTitle:"",articleSummaryContent:"",articleContent:"",articleImagePath:"",articleThumbnailImagePath:"",articleFile:"",articleDate:"",articleClass:{articleClassId:""}}),m=r([]),o=r(null),y=async t=>{try{const l=await g(`${f}/${t}`,i);e.value=l.data,o.value=`${C}${e.value.articleImagePath}`,console.log(e.value)}catch(l){b(l,i)}},I=async()=>{try{const t=await g(ee,i);console.log("fetch"),console.log(t.data),m.value=t.data,console.log("cate"),console.log(m.value)}catch(t){b(t,i)}},w=t=>{const l=t.target.files[0];l&&(o.value=URL.createObjectURL(l),e.value.articleFile=l)},v=async()=>{if(!S())return;u.fire({title:"修改中",html:"請稍等，正在處理中",allowOutsideClick:!1,didOpen:()=>{u.showLoading()}});const t=new FormData;t.append("articleId",e.value.articleId),t.append("articleTitle",e.value.articleTitle),t.append("articleSummaryContent",e.value.articleSummaryContent),t.append("articleContent",e.value.articleContent),t.append("articleImagePath",e.value.articleImagePath),t.append("articleThumbnailImagePath",e.value.articleThumbnailImagePath),t.append("articleDate",e.value.articleDate),t.append("articleClassId",e.value.articleClass.articleClassId),e.value.articleFile&&(console.log("articleFile"),t.append("articleFile",e.value.articleFile)),(await B(f,t,i)).status==200&&u.fire({title:"修改成功",icon:"success",confirmButtonText:"確定"}).then(()=>{i.push("/backstage/articles")})},k=()=>{i.push("/backstage/articles")};F(()=>{p.value=_.params.id,y(p.value),I()});const S=()=>!e.value.articleTitle.trim()||!e.value.articleContent.trim()||!e.value.articleClass.articleClassId||!e.value.articleSummaryContent.trim()?(u.fire("錯誤","請填寫所有欄位","error"),!1):!0;return(t,l)=>(n(),c("div",L,[M,a("form",{onSubmit:z(v,["prevent"])},[a("div",R,[$,d(a("input",{type:"text",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=s=>e.value.articleTitle=s),id:"title",required:""},null,512),[[h,e.value.articleTitle]])]),a("div",O,[G,d(a("select",{class:"form-select","onUpdate:modelValue":l[1]||(l[1]=s=>e.value.articleClass.articleClassId=s),id:"category"},[(n(!0),c(D,null,U(m.value,s=>(n(),c("option",{key:s.articleClassId,value:s.articleClassId},N(s.articleClassName),9,H))),128))],512),[[T,e.value.articleClass.articleClassId]])]),a("div",J,[K,a("input",{id:"image",type:"file",onChange:w,accept:"image/*"},null,32)]),o.value?(n(),c("img",{key:0,src:o.value,alt:"Image Preview",style:{width:"300px",height:"200px","object-fit":"contain"}},null,8,Q)):V("",!0),a("div",W,[X,d(a("input",{type:"text",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=s=>e.value.articleSummaryContent=s),required:""},null,512),[[h,e.value.articleSummaryContent]])]),a("div",Y,[Z,E(q(j),{"api-key":"ovyy5uubb3bz95whlsxmd1vvnnhsz98viov27xsvgwp41jzg",modelValue:e.value.articleContent,"onUpdate:modelValue":l[3]||(l[3]=s=>e.value.articleContent=s),init:{height:"50vh",autoresize_bottom_margin:20,toolbar_mode:"sliding",plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist image a11ychecker",tinycomments_mode:"embedded",tinycomments_author:"Author name",a11y_file_allowed_types:"image/*",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],ai_request:(s,x)=>x.string(()=>t.Promise.reject("See docs to implement AI Assistant"))}},null,8,["modelValue","init"])]),a("div",{class:"text-center"},[a("button",{type:"button",class:"btn btn-secondary me-2",onClick:k}," 取消 "),a("button",{type:"button",class:"btn btn-primary",onClick:v},"儲存")])],32)]))}};export{oe as default};
