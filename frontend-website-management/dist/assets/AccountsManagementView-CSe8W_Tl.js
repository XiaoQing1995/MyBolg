import{S as a,d as B,b as T,c as C,e as V}from"./api-F9C-BKG7.js";import{u as k,c as w,d as A,e as o,t as N,r as m,o as R,F as z,h as D,s as I,i as U,v as M}from"./index-CMPOgCmU.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as j}from"./Page-CCejXslC.js";import"./axios-Bo0ATomq.js";const F={class:"article-item card p-0"},G={class:"row"},L={class:"col-md-8"},W={class:"card-body"},q={class:"card-text"},H={class:"card-text"},_="/v1/accounts",J={__name:"AccountItem",props:["account","roles"],emits:["deleteAccount","updateAccount"],setup(g,{emit:v}){const r=k(),t=g,l=v,f={};t.roles.forEach(c=>{f[c.toLowerCase()]=c});const h=async()=>{console.log(t.roles[0]);const{value:c}=await a.fire({title:`請設定 ${t.account.accountNumber} 的密碼`,input:"password",inputPlaceholder:"Enter your password",inputAttributes:{maxlength:"10",autocapitalize:"off",autocorrect:"off"}});if(c){const n=m({accountId:t.account.accountId,accountNumber:t.account.accountNumber,accountPassword:c,role:t.account.role});(await B(_,n.value,r)).status==200&&a.fire({title:"修改成功",icon:"success",confirmButtonText:"確定"}).then(()=>{l("updateAccount")})}},p=async()=>{await a.fire({title:`請選擇 ${t.account.accountNumber} 的身份`,input:"select",inputOptions:f,inputPlaceholder:t.account.role,showCancelButton:!0,inputValidator:c=>new Promise(n=>{const s={accountId:t.account.accountId,accountNumber:t.account.accountNumber,accountPassword:t.account.accountPassword,role:c.toUpperCase()};s.role!==""?B(_,s,r).then(i=>{console.log(i),i.status===200&&a.fire({title:"修改成功",icon:"success",confirmButtonText:"確定"}).then(()=>{l("updateAccount")}),n()}).catch(i=>{console.error("Error updating account:",i),n()}):n()})})},b=async()=>{a.fire({title:"刪除?",text:"確定要刪除這個帳戶嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"}).then(async c=>{if(c.isConfirmed){const s=(await T(`${_}/${t.account.accountId}`,r)).status;console.log(s),s==204&&a.fire({title:"刪除!",text:"刪除成功",icon:"success"}).then(()=>{l("deleteAccount")})}})};return(c,n)=>(w(),A("div",F,[o("div",G,[o("div",L,[o("div",W,[o("p",q,N(g.account.accountNumber),1),o("p",H,N(g.account.role),1)])]),o("div",{class:"col-md-3 d-flex justify-content-end align-items-center mt-2"},[o("button",{class:"btn btn-primary mx-2",onClick:h}," 修改密碼 "),o("button",{class:"btn btn-primary mx-2",onClick:p}," 修改身份 "),o("button",{class:"btn btn-danger mx-2",onClick:b},"刪除")])])]))}},K=O(J,[["__scopeId","data-v-c723979f"]]),$="/v1/accounts",Q="/v1/roles",X=10,ot={__name:"AccountsManagementView",setup(g){const v=m([]),r=m(),t=m(1),l=m(0),f=m(!1),h=k(),p=async()=>{const e=await C(`${$}?page=${t.value-1}&size=${X}`,h);console.log(e.data),v.value=e.data.content,l.value=e.data.totalPages,i()},b=async()=>{const e=await C(Q,h);r.value=e.data},c=()=>{p()},n=async()=>{const{value:e}=await a.fire({title:"新增帳戶",html:'<input id="accountNumber" class="swal2-input" placeholder="帳號"><input id="accountPassword" type="password" class="swal2-input" placeholder="密碼"><select id="role" class="swal2-select">'+r.value.map(u=>`<option value="${u}">${u}</option>`).join("")+"</select>",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"新增",cancelButtonText:"取消",preConfirm:()=>({accountNumber:document.getElementById("accountNumber").value,accountPassword:document.getElementById("accountPassword").value,role:document.getElementById("role").value.toUpperCase()})});if(e){const{accountNumber:u,accountPassword:d,role:y}=e;if(!x(u,d,y))return;const S={accountNumber:u,accountPassword:d,role:y};try{const P=await V(`${$}`,S,h),E=P.status;console.log(P),E==200&&a.fire({title:"新增成功",icon:"success",confirmButtonText:"確定"}).then(()=>{p()})}catch(P){console.error("Error inserting account:",P)}}};R(()=>{b(),p()});const s=async e=>{e>=1&&e<=l.value&&(t.value=e,await p())},i=()=>{M(()=>{f.value=!0})},x=(e,u,d)=>!e.trim()||!u.trim()||!d.trim()?(a.fire("錯誤","請填寫所有欄位","error"),!1):!0;return(e,u)=>(w(),A("div",null,[o("button",{class:"btn btn-success",onClick:n},"新增帳戶"),(w(!0),A(z,null,D(v.value,d=>(w(),I(K,{key:d.accountId,account:d,roles:r.value,onDeleteAccount:c,onUpdateAccount:c},null,8,["account","roles"]))),128)),f.value?(w(),I(j,{key:0,currentPage:t.value,totalPages:l.value,changePage:s},null,8,["currentPage","totalPages"])):U("",!0)]))}};export{ot as default};
