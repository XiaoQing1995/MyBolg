import{u as _,r as u,o as C,d as o,e as l,z as m,A as p,B as w,F as S,h as I,i as k,f as A,C as F,D,c as n,t as T}from"./index-CMPOgCmU.js";import{c as V,S as c,e as x}from"./api-F9C-BKG7.js";import{E}from"./Editor-sdaFGOaK.js";import"./axios-Bo0ATomq.js";const U={class:"container mt-4"},B=l("h2",null,"Edit Article",-1),N={class:"mb-3"},P=l("label",{for:"title",class:"form-label"},"標題",-1),z={class:"mb-3"},j=l("label",{for:"category",class:"form-label"},"文章分類",-1),q=["value"],L={class:"mb-3"},M=l("label",{for:"image",class:"form-label"},"封面圖片",-1),O=["src"],R={class:"mb-3"},G=l("label",{for:"summaryContent",class:"form-label"},"概要內容",-1),H={class:"mb-3"},J=l("label",{for:"content",class:"form-label"},"文章內容",-1),K="/v1/articles",Q="/v1/articleclasses",ee={__name:"ArticlesInsertView",setup(W){const i=_(),e=u({articleTitle:"",articleSummaryContent:"",articleContent:"",articleDate:"",articleFile:"",articleClassId:""}),d=u([]),r=u(null),v=async()=>{var a;try{const t=await V(Q,i);console.log(t.data),d.value=t.data}catch(t){((a=t.response)==null?void 0:a.status)==403&&i.push("../login")}},f=a=>{const t=a.target.files[0];t&&(r.value=URL.createObjectURL(t),e.value.articleFile=t)},h=async()=>{if(!g())return;c.fire({title:"新增中",html:"請稍等，正在處理中",allowOutsideClick:!1,didOpen:()=>{c.showLoading()}}),e.value.articleDate=new Date().toISOString().split("T")[0];const a=new FormData;a.append("articleTitle",e.value.articleTitle),a.append("articleSummaryContent",e.value.articleSummaryContent),a.append("articleContent",e.value.articleContent),a.append("articleDate",e.value.articleDate),a.append("articleClassId",e.value.articleClassId),a.append("articleFile",e.value.articleFile),(await x(K,a,i)).status==200&&c.fire({title:"新增成功",icon:"success",confirmButtonText:"確定"}).then(()=>{i.push("/backstage/articles")})},b=()=>{e.value={articleTitle:"",articleContent:"",articleFile:"",articleClassId:""},r.value=null;const a=document.getElementById("image");a&&(a.value=null)};C(async()=>{await v()});const g=()=>!e.value.articleTitle.trim()||!e.value.articleSummaryContent.trim()||!e.value.articleContent.trim()||!e.value.articleClassId||!e.value.articleFile?(c.fire("錯誤","請填寫所有欄位","error"),!1):!0;return(a,t)=>(n(),o("div",U,[B,l("form",{onSubmit:t[4]||(t[4]=D((...s)=>a.insertArticle&&a.insertArticle(...s),["prevent"]))},[l("div",N,[P,m(l("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=s=>e.value.articleTitle=s),id:"title",required:""},null,512),[[p,e.value.articleTitle]])]),l("div",z,[j,m(l("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=s=>e.value.articleClassId=s),id:"category"},[(n(!0),o(S,null,I(d.value,s=>(n(),o("option",{key:s.articleClassId,value:s.articleClassId},T(s.articleClassName),9,q))),128))],512),[[w,e.value.articleClassId]])]),l("div",L,[M,l("input",{id:"image",type:"file",onChange:f,accept:"image/*"},null,32)]),r.value?(n(),o("img",{key:0,src:r.value,alt:"Image Preview",style:{width:"300px",height:"200px","object-fit":"contain"}},null,8,O)):k("",!0),l("div",R,[G,m(l("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=s=>e.value.articleSummaryContent=s),required:""},null,512),[[p,e.value.articleSummaryContent]])]),l("div",H,[J,A(F(E),{"api-key":"ovyy5uubb3bz95whlsxmd1vvnnhsz98viov27xsvgwp41jzg",modelValue:e.value.articleContent,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.articleContent=s),init:{height:"50vh",autoresize_bottom_margin:20,toolbar_mode:"sliding",plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist image a11ychecker",tinycomments_mode:"embedded",tinycomments_author:"Author name",a11y_file_allowed_types:"image/*",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],ai_request:(s,y)=>y.string(()=>a.Promise.reject("See docs to implement AI Assistant"))}},null,8,["modelValue","init"])]),l("div",{class:"text-center"},[l("button",{type:"button",class:"btn btn-secondary me-2",onClick:b}," 重置 "),l("button",{type:"submit",class:"btn btn-primary",onClick:h}," 儲存 ")])],32)]))}};export{ee as default};
